<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span> Tutup</button>
    <h4 class="modal-title">Riwayat Kontrol</h4>
</div>
<div class="modal-body">

  <div id="form_skontrol">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-body">
          <div class="row clearfix">
              <div class="col-md-12">
                  <div class="form-group">
                      <label>Nomor SEP</label>
                      <input type="text" name="no_sep" id="no_sep" class="form-control" />
                      <input type="text" style="display: none;" name="no_surkon" id="no_surkon" class="form-control" />
                  </div>
              </div>
              <div class="col-md-6 dokter">
                  <div class="form-group">
                      <label>Dokter</label>
                      <select class="form-control" name="dokter" id="dokter" data-use-search="true">
                        {loop: $maping_dokter_dpjpvclaim}
                        <option value="{$value.kd_dokter_bpjs}">{$value.nm_dokter_bpjs}</option>
                        {/loop}
                      </select>
                  </div>
              </div>
              <div class="col-md-6 poli">
                  <div class="form-group">
                      <label>Poli/Unit</label>
                      <select class="form-control" name="poli" id="poli" data-use-search="true">
                        {loop: $maping_poli_bpjs}
                        <option value="{$value.kd_poli_bpjs}">{$value.nm_poli_bpjs}</option>
                        {/loop}
                      </select>
                  </div>
              </div>
              <div class="col-md-6">
                  <div class="form-group">
                      <label>Tanggal Surat</label>
                      <input type="text" name="tanggal_rujukan" id="tanggal_rujukan" class="form-control tanggal" value="{?=date('Y-m-d')?}" />
                  </div>
              </div>
              <div class="col-md-6">
                  <div class="form-group">
                      <label>Tanggal Kontrol</label>
                      <input type="text" name="tanggal_datang" id="tanggal_datang" class="form-control tanggal" />
                  </div>
              </div>
          </div>
          <div class="row clearfix">
              <div class="col-md-12">
                  <button type="button" class="btn btn-primary" id="simpan_kontrol">Simpan</button>
                  <button type="button" class="btn btn-primary" id="load_kontrol">Load</button>
                  <button type="button" class="btn btn-danger" id="hapus_kontrol">Hapus</button>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <br><br>

  <div id="kontroldisplay">
  </div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-primary" data-dismiss="modal">Tutup</button>
</div>
<script type="text/javascript">
  $("#hapus_kontrol").hide();
   $('select').selectator();
   $(function () {
       $('.tanggal').datetimepicker({
         format: 'YYYY-MM-DD',
         locale: 'id'
       });
   });
   $(function () {
       $('.jam').datetimepicker({
         format: 'HH:mm:ss',
         locale: 'id'
       });
   });
</script>
<script type="text/javascript">
  $("#form_skontrol").on("click","#load_kontrol", function(event){
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    $("#kontroldisplay").show().load(baseURL + '/vclaim/kontroldisplay/{$no_kartu}?t=' + mlite.token);
    $("#hapus_kontrol").hide();
  });

  $(document).ready(function() {
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    $("#kontroldisplay").show().load(baseURL + '/vclaim/kontroldisplay/{$no_kartu}?t=' + mlite.token);
  });

  $("#form_skontrol").on("click","#simpan_kontrol", function(event){
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    var no_sep          = $('#no_sep').val();
    var no_surkon       = $('#no_surkon').val();
    var tanggal_surat   = $('#tanggal_rujukan').val();
    var tanggal_periksa = $('#tanggal_datang').val();
    var poli            = $('#poli').val();
    var dokter          = $('#dokter').val();

    var url = baseURL + '/vclaim/savekontrol?t=' + mlite.token;

    $.post(url,{
      no_sep: no_sep,
      no_surkon: no_surkon,
      tanggal_surat : tanggal_surat,
      tanggal_periksa : tanggal_periksa,
      dokter : dokter,
      poli : poli
    } ,function(data) {
        alert(data);
        $("#kontroldisplay").show().load(baseURL + '/vclaim/kontroldisplay/{$no_kartu}?t=' + mlite.token);
        $('#notif').html("<div class=\"alert alert-success alert-dismissible fade in\" role=\"alert\" style=\"border-radius:0px;margin-top:-15px;\">"+
        "Data Kontrol VClaim telah disimpan!"+
        "<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">&times;</button>"+
        "</div>").show();
    });
  });

  $("#form_skontrol").on("click","#hapus_kontrol", function(event){
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    var no_surkon       = $('#no_surkon').val();

    var url = baseURL + '/vclaim/deletesuratkontrol?t=' + mlite.token;

    $.post(url,{
      no_surkon: no_surkon
    } ,function(data) {
        alert(data);
        $("#kontroldisplay").show().load(baseURL + '/vclaim/kontroldisplay/{$no_kartu}?t=' + mlite.token);
        $('#notif').html("<div class=\"alert alert-success alert-dismissible fade in\" role=\"alert\" style=\"border-radius:0px;margin-top:-15px;\">"+
        "Data Kontrol VClaim telah disimpan!"+
        "<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">&times;</button>"+
        "</div>").show();
    });
  });

  $("#kontroldisplay").on("click", ".pilih_nosurat", function(event){
    var no_surat = $(this).attr("data-no_surat");
    $('input:text[name=sep_nomor_skdp]').val(no_surat);
    $('input:text[name=sep_nomor_rujukan]').val(no_surat);
    $('#kontrolModal').modal('hide');
  });

  $("#kontroldisplay").on("click", "#ubah_kontrol", function(event){
    var no_surkon = $(this).attr("data-no_surat");
    var no_sep = $(this).attr("data-no_sep");
    var kd_poli = $(this).attr("data-kd_poli");
    var kd_dokter = $(this).attr("data-kd_dokter");
    var tanggal_surat = $(this).attr("data-tanggal_surat");
    var tanggal_kontrol = $(this).attr("data-tanggal_kontrol");

    $('input:text[name=no_sep]').val(no_sep);
    $('input:text[name=no_surkon]').val(no_surkon);
    $('input:text[name=tanggal_rujukan]').val(tanggal_surat);
    $('input:text[name=tanggal_datang]').val(tanggal_kontrol);
    $("div.dokter select").val(kd_dokter).change();
    $("div.poli select").val(kd_poli).change();
    $('#tanggal_rujukan').attr('readonly', true);
    $('#no_sep').attr('readonly', true);
    $("#hapus_kontrol").show();
  });
</script>
