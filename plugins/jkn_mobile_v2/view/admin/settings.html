<article class="row">
    <form action="{?=url(ADMIN.'/jkn_mobile_v2/saveSettings')?}" method="POST">
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">{$settings.title}</h3>
                </div>
            	  <div class="panel-body">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" name="jkn_mobile_v2[x_username]" class="form-control" value="{$settings.jkn_mobile_v2.x_username}" />
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="text" name="jkn_mobile_v2[x_password]" class="form-control" value="{$settings.jkn_mobile_v2.x_password}" />
                    </div>
                    <div class="form-group">
                        <label>Header Token</label>
                        <input type="text" name="jkn_mobile_v2[header_token]" class="form-control" value="{$settings.jkn_mobile_v2.header_token}" />
                    </div>
                    <div class="form-group">
                        <label>Header Username</label>
                        <input type="text" name="jkn_mobile_v2[header_username]" class="form-control" value="{$settings.jkn_mobile_v2.header_username}" />
                    </div>
                    <div class="form-group">
                        <label>Header Password</label>
                        <input type="text" name="jkn_mobile_v2[header_password]" class="form-control" value="{$settings.jkn_mobile_v2.header_password}" />
                    </div>
                    <div class="form-group">
                        <label>BPJS Cons ID</label>
                        <input type="text" name="jkn_mobile_v2[BpjsConsID]" class="form-control" value="{$settings.jkn_mobile_v2.BpjsConsID}" />
                    </div>
                    <div class="form-group">
                        <label>BPJS Secret Key</label>
                        <input type="text" name="jkn_mobile_v2[BpjsSecretKey]" class="form-control" value="{$settings.jkn_mobile_v2.BpjsSecretKey}" />
                    </div>
                    <div class="form-group">
                        <label>BPJS User Key</label>
                        <input type="text" name="jkn_mobile_v2[BpjsUserKey]" class="form-control" value="{$settings.jkn_mobile_v2.BpjsUserKey}" />
                    </div>
                    <div class="form-group">
                        <label>BPJS WS Antrian</label>
                        <input type="text" name="jkn_mobile_v2[BpjsAntrianUrl]" class="form-control" value="{$settings.jkn_mobile_v2.BpjsAntrianUrl}" />
                    </div>
                    <div class="form-group">
                        <label>Tampilkan Poli</label>
                        <select name="jkn_mobile_v2[display][]" class="form-control" multiple>
                          {loop: $settings.poliklinik}
                            <option value="{$value.kd_poli}" {$value.attr}>{$value.nm_poli}</option>
                          {/loop}
                        </select>
                    </div>
                    <div class="row clearfix">
                        <div class="col-md-6">
        										<div class="form-group">
        	    	                <label>Provinsi</label>
        												<div class="input-group">
        														<input type="hidden" name="jkn_mobile_v2[kdprop]" value="{$settings.jkn_mobile_v2.kdprop}" id="kd_prop">
        														<input type="text" value="{$settings.propinsi.nm_prop}" id="namaprop" class="form-control" placeholder="Propinsi">
        														<span class="input-group-addon" data-toggle="modal" data-target="#propinsiModal">
        																<i class="fa fa-paperclip"></i>
        														</span>
        												</div>
        	    	            </div>
                        </div>
                        <div class="col-md-6">
        										<div class="form-group">
        	    	                <label>Kabupaten / Kota</label>
        												<div class="input-group">
        														<input type="hidden" name="jkn_mobile_v2[kdkab]" value="{$settings.jkn_mobile_v2.kdkab}" id="kd_kab">
        														<input type="text" value="{$settings.kabupaten.nm_kab}" id="namakab" class="form-control" placeholder="Kabupaten">
        														<span class="input-group-addon" data-toggle="modal" data-target="#kabupatenModal">
        																<i class="fa fa-paperclip"></i>
        														</span>
        												</div>
        	    	            </div>
                        </div>
                    </div>
                    <div class="row clearfix">
                        <div class="col-md-6">
        										<div class="form-group">
        	    	                <label>Kecamatan</label>
        												<div class="input-group">
        														<input type="hidden" name="jkn_mobile_v2[kdkec]" value="{$settings.jkn_mobile_v2.kdkec}" id="kd_kec">
        														<input type="text" value="{$settings.kecamatan.nm_kec}" id="namakec" class="form-control" placeholder="Kecamatan">
        														<span class="input-group-addon" data-toggle="modal" data-target="#kecamatanModal">
        																<i class="fa fa-paperclip"></i>
        														</span>
        												</div>
        	    	            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Kelurahan</label>
                                <div class="input-group">
                                    <input type="hidden" name="jkn_mobile_v2[kdkel]" value="{$settings.jkn_mobile_v2.kdkel}" id="kd_kel">
                                    <input type="text" value="{$settings.kelurahan.nm_kel}" id="namakel" class="form-control" placeholder="Kelurahan">
                                    <span class="input-group-addon" data-toggle="modal" data-target="#kelurahanModal">
                                        <i class="fa fa-paperclip"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row clearfix">
                        <div class="col-md-6">
        										<div class="form-group">
        	    	                <label>Perusahaan Pasien</label>
                                <select name="jkn_mobile_v2[perusahaan_pasien]" class="form-control">
          												{loop: $settings.perusahaan_pasien}
          													<option value="{$value.kode_perusahaan}"{if: $value.kode_perusahaan == $settings.jkn_mobile_v2.perusahaan_pasien} selected{/if}>{$value.nama_perusahaan}</option>
          												{/loop}
          											</select>
        	    	            </div>
                        </div>
                        <div class="col-md-6">
        										<div class="form-group">
        	    	                <label>Suku Bangsa Pasien</label>
                                <select name="jkn_mobile_v2[suku_bangsa]" class="form-control">
          												{loop: $settings.suku_bangsa}
          													<option value="{$value.id}"{if: $value.id == $settings.jkn_mobile_v2.suku_bangsa} selected{/if}>{$value.nama_suku_bangsa}</option>
          												{/loop}
          											</select>
        	    	            </div>
                        </div>
                    </div>
                    <div class="row clearfix">
                        <div class="col-md-6">
        										<div class="form-group">
        	    	                <label>Bahasa Pasien</label>
                                <select name="jkn_mobile_v2[bahasa_pasien]" class="form-control">
          												{loop: $settings.bahasa_pasien}
          													<option value="{$value.id}"{if: $value.id == $settings.jkn_mobile_v2.bahasa_pasien} selected{/if}>{$value.nama_bahasa}</option>
          												{/loop}
          											</select>
        	    	            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Cacat Fisik</label>
                                <select name="jkn_mobile_v2[cacat_fisik]" class="form-control">
          												{loop: $settings.cacat_fisik}
          													<option value="{$value.id}"{if: $value.id == $settings.jkn_mobile_v2.cacat_fisik} selected{/if}>{$value.nama_cacat}</option>
          												{/loop}
          											</select>
                            </div>
                        </div>
                    </div>
                    <input type="submit" name="save" class="btn btn-primary" value="Simpan" />
                </div>
            </div>
        </div>
    </form>
</article>

<div class="modal fade" id="propinsiModal" tabindex="-1" role="dialog" aria-labelledby="propinsiModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
				<div class="modal-content">
						<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								<h4 class="modal-title" id="propinsiModalLabel">Database Propinsi</h4>
						</div>
						<div class="modal-body">
								<table class="table table-striped table-hover propinsi" width="100%">
										<thead>
												<tr>
														<th>Kode</th>
														<th>Nama Propinsi</th>
												</tr>
										</thead>
										<tbody id="propinsi">
										</tbody>
								</table>
						</div>
				</div>
		</div>
</div>

<div class="modal fade" id="kabupatenModal" tabindex="-1" role="dialog" aria-labelledby="kabupatenModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
				<div class="modal-content">
						<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								<h4 class="modal-title" id="kabupatenModalLabel">Database Kabupaten</h4>
						</div>
						<div class="modal-body">
								<table class="table table-striped table-hover kabupaten" width="100%">
										<thead>
												<tr>
														<th>Kode</th>
														<th>Nama Kabupaten</th>
												</tr>
										</thead>
										<tbody id="kabupaten">
										</tbody>
								</table>
						</div>
				</div>
		</div>
</div>

<div class="modal fade" id="kecamatanModal" tabindex="-1" role="dialog" aria-labelledby="kecamatanModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
				<div class="modal-content">
						<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								<h4 class="modal-title" id="kecamatanModalLabel">Database Kecamatan</h4>
						</div>
						<div class="modal-body">
								<table class="table table-striped table-hover kecamatan" width="100%">
										<thead>
												<tr>
														<th>Kode</th>
														<th>Nama Kecamatan</th>
												</tr>
										</thead>
										<tbody id="kecamatan">
										</tbody>
								</table>
						</div>
				</div>
		</div>
</div>

<div class="modal fade" id="kelurahanModal" tabindex="-1" role="dialog" aria-labelledby="kelurahanModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
				<div class="modal-content">
						<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								<h4 class="modal-title" id="kelurahanModalLabel">Database Kelurahan</h4>
						</div>
						<div class="modal-body">
								<table class="table table-striped table-hover kelurahan" width="100%">
										<thead>
												<tr>
														<th>Kode</th>
														<th>Nama Kelurahan</th>
												</tr>
										</thead>
								</table>
						</div>
				</div>
		</div>
</div>

<script type="text/javascript">

  $(document).ready(function(){
      $.ajax({
        type: 'GET',
        url: '{?=url()?}/admin/jkn_mobile_v2/ajax?show=propinsi&t={?=$_SESSION['token']?}',
        success: function(response) {
          $('#propinsi').html(response);
          $('.propinsi').DataTable({
            "language": { "search": "", "searchPlaceholder": "Search..." },
            "lengthChange": false,
            "scrollX": true,
            dom: "<<'data-table-title'><'datatable-search'f>><'row'<'col-sm-12'tr>><<'pmd-datatable-pagination' l i p>>"
          });
          var t = $(".propinsi").DataTable().rows().count();
          $(".data-table-title").html('<h3 style="display:inline;float:left;margin-top:0;" class="hidden-xs">Total: ' + t + '</h3>');
          console.log(response);
        }
      })
  });

  $(document).on('click', '.pilihpropinsi', function (e) {
    $("#kd_prop")[0].value = $(this).attr('data-kdprop');
    $("#namaprop")[0].value = $(this).attr('data-namaprop');
    $('#propinsiModal').modal('hide');
    $.ajax({
      type: 'GET',
      url: '{?=url()?}/admin/jkn_mobile_v2/ajax?show=kabupaten&t={?=$_SESSION['token']?}',
      success: function(response) {
        $('#kabupaten').html(response);
        $('.kabupaten').DataTable({
          "language": { "search": "", "searchPlaceholder": "Search..." },
          "lengthChange": false,
          "scrollX": true,
          dom: "<<'data-table-title'><'datatable-search'f>><'row'<'col-sm-12'tr>><<'pmd-datatable-pagination' l i p>>"
        });
        var t = $(".kabupaten").DataTable().rows().count();
        $(".data-table-title").html('<h3 style="display:inline;float:left;margin-top:0;" class="hidden-xs">Total: ' + t + '</h3>');
        //console.log(kd_prop);
      }
    })
  });

  $(document).on('click', '.pilihkabupaten', function (e) {
    $("#kd_kab")[0].value = $(this).attr('data-kdkab');
    $("#namakab")[0].value = $(this).attr('data-namakab');
    $('#kabupatenModal').modal('hide');
    $.ajax({
      type: 'GET',
      url: '{?=url()?}/admin/jkn_mobile_v2/ajax?show=kecamatan&t={?=$_SESSION['token']?}',
      success: function(response) {
        $('#kecamatan').html(response);
        $('.kecamatan').DataTable({
          "language": { "search": "", "searchPlaceholder": "Search..." },
          "lengthChange": false,
          "scrollX": true,
          dom: "<<'data-table-title'><'datatable-search'f>><'row'<'col-sm-12'tr>><<'pmd-datatable-pagination' l i p>>"
        });
        var t = $(".kecamatan").DataTable().rows().count();
        $(".data-table-title").html('<h3 style="display:inline;float:left;margin-top:0;" class="hidden-xs">Total: ' + t + '</h3>');
        //console.log(response);
      }
    })
  });

  $(document).on('click', '.pilihkecamatan', function (e) {
    $("#kd_kec")[0].value = $(this).attr('data-kdkec');
    $("#namakec")[0].value = $(this).attr('data-namakec');
    $('#kecamatanModal').modal('hide');
    $('.kelurahan').DataTable({
      "lengthChange": false,
      "scrollX": true,
      "processing": true,
      "serverSide": true,
      "ajax": '{?=url()?}/admin/jkn_mobile_v2/ajax?show=kelurahan&t={?=$_SESSION['token']?}',
      "language": { "search": "", "searchPlaceholder": "Search..." },
      dom: "<<'data-table-title'><'datatable-search'f>><'row'<'col-sm-12'tr>><<'pmd-datatable-pagination' l i p>>"
    });
    //var t = $(".kelurahan").DataTable().rows().count();
    //$(".data-table-title").html('<h3 style="display:inline;float:left;margin-top:0;" class="hidden-xs">Total: ' + t + '</h3>');
  });

  $(document).on('click', '.pilihkelurahan', function (e) {
      $("#kd_kel")[0].value = $(this).attr('data-kdkel');
      $("#namakel")[0].value = $(this).attr('data-namakel');
      $('#kelurahanModal').modal('hide');
  });

</script>
